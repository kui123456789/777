# 我的乖乖女友 - 角色卡项目

## 项目结构

```
src/我的乖乖女友/
├── schema.ts                    # 变量结构定义
├── 脚本/
│   ├── 变量结构/index.ts        # 注册MVU变量结构
│   └── MVU/index.ts             # MVU框架导入
├── 界面/
│   └── 状态栏/                  # 姜林手写笔记风格状态栏
│       ├── App.vue
│       ├── store.ts
│       ├── index.ts
│       ├── index.html
│       └── global.css
├── 世界书/
│   ├── index.yaml               # 世界书主配置
│   └── 变量/
│       ├── initvar.yaml         # 变量初始值
│       ├── 变量更新规则.yaml
│       ├── 变量列表.txt
│       └── 变量输出格式.yaml
├── 第一条消息/
│   └── 0.txt                    # 开场白
└── 导入到酒馆中/                # 实时修改配置文件
    ├── MVU脚本-实时修改.json
    ├── 变量结构脚本-实时修改.json
    ├── 状态栏界面-实时修改.json
    └── 世界书.json              # 打包好的世界书
```

## 导入到酒馆的步骤

### 1. 启动开发服务器

在项目根目录运行：

```bash
pnpm watch
```

这会：

- 编译打包项目到 `dist/` 目录
- 启动 localhost:5500 的开发服务器
- 监听文件变化自动重新打包

### 2. 导入脚本到酒馆

在酒馆中打开角色卡的 **酒馆助手 → 脚本库**，依次导入：

1. **MVU脚本**: 导入 `导入到酒馆中/MVU脚本-实时修改.json`
2. **变量结构脚本**: 导入 `导入到酒馆中/变量结构脚本-实时修改.json`

导入方法：点击"导入脚本"按钮，选择对应的 JSON 文件。

### 3. 导入正则表达式到酒馆

在酒馆中打开 **扩展 → 正则表达式**，导入：

- **状态栏界面**: 导入 `导入到酒馆中/状态栏界面-实时修改.json`

这个正则会把消息中的 `<StatusPlaceHolderImpl/>` 替换为状态栏界面。

### 4. 启用实时监听

在酒馆中打开 **扩展 → 酒馆助手**，确保 **实时监听-允许监听** 开关已启用。

这样代码修改后，酒馆会自动热重载新的脚本和界面。

### 5. 导入世界书

在酒馆的 **世界书管理** 中，点击"导入"按钮，导入：

- `导入到酒馆中/世界书.json`

世界书会以"我的乖乖女友"的名称导入。

#### 重新打包世界书

如果修改了 `世界书/` 文件夹中的内容，需要重新打包：

```bash
node tavern_sync.mjs bundle 我的乖乖女友
```

打包结果会直接生成到 `导入到酒馆中/世界书.json`。

## 变量说明

### 世界状态
| 变量路径             | 类型   | 说明                                  |
| -------------------- | ------ | ------------------------------------- |
| 世界.当前时间        | string | 当前时间 (格式: YYYY年MM月DD日 HH:MM) |
| 世界.当前地点        | string | 当前场景位置                          |

### 姜林（女主角）
| 变量路径             | 类型   | 说明                                  |
| -------------------- | ------ | ------------------------------------- |
| 姜林.基础状态.好感度 | number | 0-100，对User的好感程度               |
| 姜林.基础状态.心情   | string | 当前心情状态                          |
| 姜林.基础状态.体力   | number | 0-100，当前体力值                     |
| 姜林.财务.现金       | number | 当前持有现金（精确到0.1元）           |
| 姜林.财务.欠债       | number | 欠User的金额                          |
| 姜林.财务.打工收入   | number | 累计打工收入                          |
| 姜林.身体.*          | object | 腿长、大腿围、私密部位等身体数据      |
| 姜林.背包            | object | 物品栏，key为物品名                   |

### 沈婉清（霸凌者校花）
| 变量路径                    | 类型    | 说明                                  |
| --------------------------- | ------- | ------------------------------------- |
| 沈婉清状态.屈从度           | number  | 0-100，对玩家的屈从程度               |
| 沈婉清状态.好感度           | number  | -100~100，对玩家的好感度              |
| 沈婉清状态.心情             | number  | 0-100，当前心情值                     |
| 沈婉清状态.当前状态         | string  | 傲慢/震惊/妥协/恐惧/崩坏等阶段状态    |
| 沈婉清状态.关系             | string  | 同学/奴隶/玩物等关系状态              |
| 沈婉清状态.是否处女         | boolean | 是否为处女                            |
| 沈婉清状态.是否怀孕         | boolean | 是否怀孕                              |
| 沈婉清状态.存款             | number  | 当前存款金额                          |
| 沈婉清身体.*                | object  | 身体数据                              |
| 沈婉清背包                  | object  | 物品栏                                |

## 开发提示

- 修改 `schema.ts` 后，`pnpm watch` 会自动生成 `schema.json`
- 可以使用 `schema.json` 来验证 `initvar.yaml` 的格式
- 界面和脚本代码修改后会自动热重载到酒馆
