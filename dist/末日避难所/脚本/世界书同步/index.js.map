{"version":3,"file":"index.js","mappings":"AAKA,MAAMA,EAAiB,QAGvBC,eAAeC,IACb,IACEC,QAAQC,KAAK,oBAAoBJ,QAGjC,MAAMK,QAAiBC,MAPL,kDAQlB,IAAKD,EAASE,GACZ,MAAM,IAAIC,MAAM,YAAYH,EAASI,UAAUJ,EAASK,cAG1D,MAAMC,QAAsBN,EAASO,OAC/BC,EAAaC,OAAOC,KAAKJ,EAAcK,SAAW,CAAC,GAAGC,OAKtDC,EAAOC,OAAOC,OAAeC,YAAYC,aAY/C,aARMJ,EAAIK,cAAcvB,EAAgBW,GAAe,SAGjDO,EAAIM,sBAEVrB,QAAQC,KAAK,oBAAoBS,SACjCY,OAAOC,QAAQ,QAAQ1B,WAAwBa,QAAkB,UAE1D,CACT,CAAE,MAAOc,GAGP,OAFAxB,QAAQwB,MAAM,gBAAiBA,GAC/BF,OAAOE,MAAM,SAASA,aAAiBnB,MAAQmB,EAAMC,QAAUD,IAAS,UACjE,CACT,CACF,CAGAE,QAAQC,eAAe,SAAU7B,gBACzBC,MAGR6B,EAAE,KACA5B,QAAQC,KAAK,iBAGbF","sources":["src://tavern_helper_template/src/末日避难所/脚本/世界书同步/index.ts"],"sourcesContent":["/**\n * 世界书实时同步脚本\n * 从本地开发服务器加载 JSON 文件导入世界书到酒馆\n */\n\nconst WORLDBOOK_NAME = '末日避难所';\nconst WORLDBOOK_URL = 'http://localhost:5500/src/末日避难所/世界书/末日避难所.json';\n\nasync function importWorldbook() {\n  try {\n    console.info(`[世界书同步] 正在导入世界书: ${WORLDBOOK_NAME}...`);\n\n    // 从本地服务器加载世界书 JSON\n    const response = await fetch(WORLDBOOK_URL);\n    if (!response.ok) {\n      throw new Error(`加载世界书失败: ${response.status} ${response.statusText}`);\n    }\n\n    const worldbookData = await response.json();\n    const entryCount = Object.keys(worldbookData.entries || {}).length;\n\n    // 获取 SillyTavern 上下文\n    // 脚本在 iframe 中运行，需要通过 window.parent 访问主页面的 SillyTavern\n    // SillyTavern 对象只有 libs 和 getContext 两个属性，所有方法都在 getContext() 返回的对象上\n    const ctx = (window.parent as any).SillyTavern.getContext();\n\n    // 使用 SillyTavern 的 saveWorldInfo API 保存世界书\n    // 保存世界书（immediately=true 立即保存）\n    await ctx.saveWorldInfo(WORLDBOOK_NAME, worldbookData, true);\n\n    // 刷新世界书列表\n    await ctx.updateWorldInfoList();\n\n    console.info(`[世界书同步] 世界书已同步，共 ${entryCount} 个条目`);\n    toastr.success(`世界书 \"${WORLDBOOK_NAME}\" 已同步 (${entryCount} 条目)`, '世界书同步');\n\n    return true;\n  } catch (error) {\n    console.error(`[世界书同步] 同步失败:`, error);\n    toastr.error(`同步失败: ${error instanceof Error ? error.message : error}`, '世界书同步');\n    return false;\n  }\n}\n\n// 注册按钮事件：手动同步世界书\neventOn(getButtonEvent('同步世界书'), async () => {\n  await importWorldbook();\n});\n\n$(() => {\n  console.info(`[世界书同步] 脚本已加载`);\n\n  // 初始同步\n  importWorldbook();\n});\n"],"names":["WORLDBOOK_NAME","async","importWorldbook","console","info","response","fetch","ok","Error","status","statusText","worldbookData","json","entryCount","Object","keys","entries","length","ctx","window","parent","SillyTavern","getContext","saveWorldInfo","updateWorldInfoList","toastr","success","error","message","eventOn","getButtonEvent","$"],"ignoreList":[],"sourceRoot":""}