{"version":3,"file":"index.js","mappings":"AAaAA,EAAE,KACAC,QAAQC,KAAK,oBAGbC,sBAAsB,OAAOC,KAAK,KAChCC,QAAQC,IAAIC,OAAOC,sBAAuB,CAACC,EAAeC,KACxD,MAAMC,EAAcC,EAAEC,IAAIH,EAAe,UACnCI,EAAcF,EAAEC,IAAIJ,EAAe,UACnCM,EAAkBH,EAAEC,IAAIJ,EAAe,WAG7C,GAAIE,IAAgBG,EAKpB,GAHAb,QAAQC,KAAK,qBAAqBS,OAAiBG,KAG3B,OAApBC,GAMJ,QAAoBC,IAAhBF,EAA2B,CAC7B,IAAIG,EAGFA,EADEH,GAAe,GACH,KACLA,GAAe,GACV,KACLA,GAAe,GACV,KAEA,MAGZC,IAAoBE,IACtBhB,QAAQC,KAAK,sBAAsBa,OAAqBE,KACxDL,EAAEM,IAAIT,EAAe,UAAWQ,GAEpC,OAtBEhB,QAAQC,KAAK,gCAyBjBD,QAAQC,KAAK,4BAIfF,EAAEmB,QAAQC,GAAG,WAAY,KACvBnB,QAAQC,KAAK","sources":["src://tavern_helper_template/src/我的乖乖女友/脚本/关系状态自动更新/index.ts"],"sourcesContent":["/**\n * 关系状态自动更新脚本\n *\n * 当好感度变化时，自动根据好感度范围更新关系状态：\n * - 0-29: 陌生人\n * - 30-59: 朋友\n * - 60-79: 暧昧\n * - 80-99: 恋人\n * - 100: 从属（需要手动触发，此脚本不会自动设置）\n *\n * 此脚本会根据好感度自动调整关系状态，包括降级\n */\n\n$(() => {\n  console.info('[关系状态自动更新] 脚本已加载');\n\n  // 监听变量更新结束事件\n  waitGlobalInitialized('Mvu').then(() => {\n    eventOn(Mvu.events.VARIABLE_UPDATE_ENDED, (new_variables, old_variables) => {\n      const oldGoodwill = _.get(old_variables, '姜林.好感度') as number | undefined;\n      const newGoodwill = _.get(new_variables, '姜林.好感度') as number | undefined;\n      const currentRelation = _.get(new_variables, '姜林.关系状态') as string | undefined;\n\n      // 如果好感度没有变化，不处理\n      if (oldGoodwill === newGoodwill) return;\n\n      console.info(`[关系状态自动更新] 好感度变化: ${oldGoodwill} → ${newGoodwill}`);\n\n      // 如果是从属关系，不自动调整（这是最高级关系，需要剧情触发解除）\n      if (currentRelation === '从属') {\n        console.info(`[关系状态自动更新] 当前关系为\"从属\"，不自动调整`);\n        return;\n      }\n\n      // 根据好感度自动调整关系状态\n      if (newGoodwill !== undefined) {\n        let newRelation: string;\n\n        if (newGoodwill >= 80) {\n          newRelation = '恋人';\n        } else if (newGoodwill >= 60) {\n          newRelation = '暧昧';\n        } else if (newGoodwill >= 30) {\n          newRelation = '朋友';\n        } else {\n          newRelation = '陌生人';\n        }\n\n        if (currentRelation !== newRelation) {\n          console.info(`[关系状态自动更新] 关系状态变化: ${currentRelation} → ${newRelation}`);\n          _.set(new_variables, '姜林.关系状态', newRelation);\n        }\n      }\n    });\n\n    console.info('[关系状态自动更新] MVU 事件监听已注册');\n  });\n\n  // 卸载时清理\n  $(window).on('pagehide', () => {\n    console.info('[关系状态自动更新] 脚本已卸载');\n  });\n});"],"names":["$","console","info","waitGlobalInitialized","then","eventOn","Mvu","events","VARIABLE_UPDATE_ENDED","new_variables","old_variables","oldGoodwill","_","get","newGoodwill","currentRelation","undefined","newRelation","set","window","on"],"ignoreList":[],"sourceRoot":""}